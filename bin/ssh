#!/bin/bash

usage() {
    echo usage
}

set_ips() {
    ssh_port="22"
    case $1 in
        aws       ) ip_int="34.210.71.203"; ip_ext="$ip_int" ;;
        pi        ) ip_int="192.168.1.131"; ip_ext="75.132.101.100" ;;
        deb|debian) ip_int="192.168.1.132"; ip_ext="75.132.101.100"; ssh_port="22132" ;;
        *         ) echo "Unknown host: $1" >&2; exit 1 ;;
    esac
}

args=( $@ )
for i in ${!args[@]}; do
    if [[ ${args[$i]} == --help ]]; then
        usage
        exit
    elif [[ ${args[$i]} == --super ]]; then
        unset args[$i]
        /usr/bin/ssh ${args[@]}
        exit
    fi
done

while [[ $1 ]]; do
    case $1 in
        -x) use_ext=true; shift ;;
        to) shift; host="$1"; set_ips "$1"; shift ;;
        * ) echo "Option not recognized: $arg" >&2; exit 1 ;;
    esac
done

if [[ -z $host ]]; then
    echo "No host specified" >&2
    exit 1
fi

if [[ $use_ext != true ]]; then
    nc -w 3 -z "$ip_int" 22 2>/dev/null
    if [[ $? == 0 ]]; then
        /usr/bin/ssh "nelson@$ip_int"
        exit
    fi
fi

nc -w 3 -z "$ip_ext" "$ssh_port" 2>/dev/null
if [[ $? == 0 ]]; then
    /usr/bin/ssh "nelson@$ip_ext" -p "$ssh_port"
else
    echo "Could not connect to host $ip_ext on port $ssh_port" >&2
fi
