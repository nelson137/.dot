#!/bin/bash
#
# Get battery stats



bat_help() {
    echo 'Usage: bat [-h|--help]'
    echo
    echo 'Get battery stats.'
    echo
    echo 'Options:'
    echo '  -h, --help  Print this help message and exit'
    exit
}



bat_err() {
    [[ "$1" == help ]] &&
        bat_help >&2

    echo "bat: $1" >&2
    exit 1
}



bat() {
    # Split options
    # Ex: -abc becomes -a -b -c
    local argv=()
    while (( $# > 0 )); do
        if [[ "$1" =~ ^-[^\-]{2,}$ ]]; then
            for (( i=1; i<${#1}; i++ )); do
                argv+=( "-${1:i:1}" )
            done
        else
            argv+=( "$1" )
        fi
        shift
    done

    # Parse arguments
    local help
    for arg in "${argv[@]}"; do
        case "$arg" in
            -h|--help)
                help=1 ;;
            -*|--*)
                bat_err "option not recognized: $arg" ;;
            *)
                bat_err "argument not recognized: $arg" ;;
        esac
        shift
    done

    [[ "$help" == 1 ]] &&
        bat_help

    if ! which upower >/dev/null; then
        bat_err 'upower is not installed'
    fi

    upower -i "$(upower -e | grep BAT)" |
        grep -E --color=never 'state|to empty|percentage'
}



bat "$@"
